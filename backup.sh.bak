#!/bin/sh
# $1 = user
# $2 = destinaionfiles
if [ $# -eq 0 ]
    then
        echo "USAGE: '$0' username destinationpath"
        exit 1
fi
# echo -e $USERPASS|sudo -S mount -rtDvz
sleep 5
WEBHOOK_URL="https://discord.com/api/webhooks/1175156341027897354/am4XoajWvByCWM7FynU2u7yJDP9DQCr42pvjntOBXzINxsNRQbjyHovMm5EfTBE3Tj3J"
tmpfile="/home/$1/backup.tmp"
#-------Start Notify--------------------------------------------------------------
beginmsg="$1 on $(hostname) Backup script Started  $(date +%c)"
#/usr/bin/notify-send -t 0 "$(echo -e $beginmsg)"
MESSAGE="$(echo -e $beginmsg)"
PAYLOAD='{"content": "'"$MESSAGE"'"}'
curl -X POST -H "Content-Type: application/json" -d "$PAYLOAD" "$WEBHOOK_URL"
#-------Run Script--------------------------------------------------------------
rsync -rtDvz --exclude-from "/home/$1/bin/rsyncexclude.txt" \
--delete-after --delete-excluded /home/$1 $2 2>&1 >> \
/mnt/backup/logs/$(hostname)-$1-$(date +%Y%m%d%H%M).log
#-------End Notify--------------------------------------------------------------
endmsg="$1 on $(hostname) Backup script completed  $(date +%c)"
#/usr/bin/notify-send -t 0 "$(echo -e $endmsg)"
MESSAGE="$(echo -e $endmsg)"
PAYLOAD='{"content": "'"$MESSAGE"'"}'
curl -X POST -H "Content-Type: application/json" -d "$PAYLOAD" "$WEBHOOK_URL"
